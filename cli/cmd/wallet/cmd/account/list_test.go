package account_test

import (
	"bytes"
	"testing"

	"github.com/stretchr/testify/require"

	"github.com/bloxapp/eth2-key-manager/cli/cmd"
	"github.com/bloxapp/eth2-key-manager/cli/util/printer"
)

func TestAccountList(t *testing.T) {
	t.Run("Successfully list accounts", func(t *testing.T) {
		var output bytes.Buffer
		cmd.ResultPrinter = printer.New(&output)
		cmd.RootCmd.SetArgs([]string{
			"wallet",
			"account",
			"list",
			"--storage=7b226163636f756e7473223a2237623232363633383331333933323332363633303264333033373338333532643334363133333330326436323634333836333264333733353338363336353332363133373331363633313334323233613762323236323631373336353431363336333666373536653734353036313734363832323361323232663331323232633232363936343232336132323636333833313339333233323636333032643330333733383335326433343631333333303264363236343338363332643337333533383633363533323631333733313636333133343232326332323665363136643635323233613232363136333633366637353665373432643331323232633232373636313663363936343631373436393666366534623635373932323361376232323639363432323361323233353632333933323334363233323631326433333334363633383264333436313636333532643339333336313331326433303333333333323331363433383631333033343337363232323263323237303631373436383232336132323664326633313332333333383331326633333336333033303266333132663330326633303232326332323730373236393736346236353739323233613232333536323331363636333635333233313335363336313634363233323335333033363333363436343332333036323633333136313339333333393336333036343336363636343337363536363330333836353631333436323333333236343335333736323338333036363631363436333339363633353333363536363331363432323764326332323737363937343638363437323631373736313663353037353632346236353739323233613232333833353338363533333330363436363333333336323636363436343336333133333332333333343631363236333339333333353339363336333634333933323334363633343338333033373636333136323631333233313634363533333332333836343333333633313635333733323636333836333339363336313339333436333339363233373633333233323335333533333336333433303335333133343331363436363338333233333339363436323338333736323634333533313330323237643764222c226174744d656d6f7279223a2237623764222c226e6574776f726b223a223730373937323664366636653734222c2270726f706f73616c4d656d6f7279223a2237623764222c2277616c6c6574223a223762323236393634323233613232333136343330363533393631363536313264363133383334333132643334363333363333326433393634333733333264333836323333363233383334333436363331333933393337323232633232363936653634363537383464363137303730363537323232336137623232363233343331363436363333363333333332333236313336363636343333333033353636363333393334333233353634363633353332333533303331363633373636333833303336333736343632363236313335333533313334333633363634333833323634333533303336363333383333363333363631363233323338333733353338333033323330333236313631333136313333333433343339363633353334363233393632363333343336333436313330333436323337333036353336323233613232363633383331333933323332363633303264333033373338333532643334363133333330326436323634333836333264333733353338363336353332363133373331363633313334323237643263323237343739373036353232336132323438343432323764227d",
		})
		err := cmd.RootCmd.Execute()
		actualOutput := output.String()
		require.NotNil(t, actualOutput)
		require.NoError(t, err)
	})

	t.Run("Fail to JSON un-marshal", func(t *testing.T) {
		var output bytes.Buffer
		cmd.ResultPrinter = printer.New(&output)
		cmd.RootCmd.SetArgs([]string{
			"wallet",
			"account",
			"list",
			"--storage=7b226163636f756e7473223a2237623764222c226174744d656d6f7279223a2237623764222c2270726f706f",
		})
		err := cmd.RootCmd.Execute()
		require.Error(t, err)
		require.EqualError(t, err, "failed to JSON un-marshal storage: unexpected end of JSON input")
	})
}
